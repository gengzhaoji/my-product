import{S as ce,t as V,h as re,P as de,r as pe,l as ue,G as me,v as fe,w as _e,g as he,a as ge,x as we,V as w,R as be,M as W,T as ve,i as xe,j as ye,n as Fe,o as Me,p as Se,q,y as Ce,z as Pe,A as ke,d as Be,u as De,B as Ee,E as Le,F as Re,_ as ze}from"./threeMinx-2c4305b0.js";import{_ as N,ba as Ie,o as H,c as X,b as t,t as d,u as l,h as Y,a1 as Ae,d as J,p as $e,e as je,a6 as Oe,g as z,a7 as Ge,a8 as Te,U as Ue,a9 as Ve,B as We,al as qe,aa as Ne,ab as He,w as Xe,at as Ye,f as Je,aT as Ke}from"./index-a360b131.js";import{E as Qe}from"./el-progress-7e7e81d9.js";import{M as Ze}from"./MapControls-fb6fb511.js";const I=p=>($e("data-v-e9dcbce6"),p=p(),je(),p),et=["onClick"],tt={class:"title"},at={class:"flex m-t-4"},st=["src"],nt={class:"w100 flex-col m-around p-b-4"},ot={class:"flex m-between"},it=I(()=>t("span",{class:"key"},"进度",-1)),lt={class:"val"},ct={class:"flex m-between"},rt=I(()=>t("span",{class:"key"},"设计长度",-1)),dt={class:"val"},pt={class:"flex m-between"},ut=I(()=>t("span",{class:"key"},"当前已掘",-1)),mt={class:"val"},ft=J({name:"labelDemo"}),_t=Object.assign(ft,{props:{data:{},callBack:Function},setup(p){const b=p,{data:o}=Ie(b);function i(){var a;(a=b.callBack)==null||a.apply()}return(a,c)=>{const u=Qe;return H(),X("div",{onClick:Ae(i,["stop"]),class:"label"},[t("div",tt,d(l(o).name),1),t("div",at,[t("img",{src:a.getImgUrl(l(o).img),class:"img"},null,8,st),t("div",nt,[t("div",null,[t("div",ot,[it,t("span",lt,d(l(o).p1)+"%",1)]),Y(u,{percentage:l(o).p1,"show-text":!1},null,8,["percentage"])]),t("div",ct,[rt,t("span",dt,d(l(o).p2)+"米",1)]),t("div",pt,[ut,t("span",mt,d(l(o).p3)+"米",1)])])])],8,et)}}}),ht=N(_t,[["__scopeId","data-v-e9dcbce6"]]);const gt={style:{position:"absolute","z-index":"10"},class:"flex-center w100 h100"},wt={class:"fw",style:{"font-size":"30px"}},bt={class:"geo-box",style:{right:"10px",bottom:"10px"}},vt=J({name:"tunnelling"}),xt=Object.assign(vt,{props:{type:{type:Number}},setup(p){const b=p;let o=Oe(null),i,a,c,u,f,k=z(!1),A=z(0),v,x;Ge(o,e=>{v=e[0].contentRect.width,x=e[0].contentRect.height,c.aspect=v/x,c.updateProjectionMatrix(),i.setSize(v,x),f.setSize(v,x)}),Te(()=>{k.value=!0,K()}),Ue(()=>{cancelAnimationFrame(T),i==null||i.dispose(),a.clear(),o=null,a=null,f=null});function K(){a=new ce;const e=V.load("/my-product/model/blue2.jpg");e.colorSpace=re,a.background=e,c=new de(45,o.value.offsetWidth/o.value.offsetHeight,1,2e3),c.position.set(109.63564910104216,86.72574213762547,96.25213350271133),a.add(c),i=pe(o),f=ue(o,!1),u=new Ze(c,i.domElement),u.target.set(110.48293056262132,-50.336801686323525,-3.7927571043980493),u.minPolarAngle=0,u.maxPolarAngle=Math.PI/2,Q()}let m,B,D,$=[],y=[117.076481,0,31.660061];function Q(){new Ve().get("/my-product/model/巷道综采面.glb").then(e=>{let s=URL.createObjectURL(e);me.load(s,n=>{k.value=!1,m=n.scene,m.position.set(...y),ae(m.position),a.add(m),a.add(h),te(),se(),B=fe({position:[95.52323002621776,.5,8.750725876978073],color:"#224c9b"}),D=_e({position:[110.83454919902249,.2,58.714054633146574],width:3}),ne();const r=n.animations,C=new he(m),P=[];for(var g=0;g<r.length;g++)P.push(C.clipAction(r[g]));P.forEach(L=>{L.play()}),$.push(C),U()},n=>{n.lengthComputable&&(A.value=Math.round(n.loaded/n.total*100,2))})})}const h=new ge;let j=[[{name:"302综采面",p1:25,p2:"5224",p3:"2114",img:"../assets/img/label/cutterIcon.png",position:[99.1077263429123,8.248901329934597,-10.28176099837259],linePosition:[100.3963106641738,0,-16.88645495791792]},{name:"403综采面",p1:25,p2:"5224",p3:"2114",img:"../assets/img/label/cutterIcon.png",position:[95.64950652097956,.24890132993459702,39.081880408165695]}],[{name:"11207掘进面",p1:25,p2:"5224",p3:"2114",img:"../assets/img/label/tunnellerIcon.png",position:[110.60365415557996,8.248901329934597,40.15225244267442],linePosition:[110.13400688846471,0,37.40728372522278]}]];We(()=>b.type,e=>{h&&h.clear(),j[e]&&j[e].forEach(s=>Z(s))},{immediate:!0});function Z(e){const s=Ye(ht,{data:Je(()=>e),callBack:function(){console.log(e)}}).use(Ke).mount(document.createElement("div")).$el,n=new De(s);n.position.set(...e.position),n.center=new q(.5,1),h.add(n),e.linePosition&&ee(e)}function ee(e){const s=new Ee(new Le().setFromPoints([new w(...e.linePosition),new w(...e.position)]),new Re({color:"#D0F1FC",dashSize:1,gapSize:.5,linewidth:3}));s.computeLineDistances(),h.add(s)}let F;function te(){const e=new we([new w(89.77380574060942,0,72.93748384923792),new w(89.78317699663523,0,32.12647226937418),new w(173.29293620343606,0,32.14087952295474)],!1,"catmullrom",0);let s=V.load("/my-product/model/line1.png");s.wrapS=s.wrapT=be,s.repeat.set(50,2),F=new W(new ve(e,1e3,.3,8),new xe({opacity:1,map:s,transparent:!0,depthWrite:!0,depthTest:!0})),a.add(F)}let _;function ae({x:e,y:s,z:n}){_=new W(new ye(1e3,1e3),new Fe({color:16777215,side:Me,opacity:0,transparent:!0})),_.rotation.x=.5*Math.PI,_.position.set(e,s,n),a.add(_),i.domElement.addEventListener("mousedown",r=>{r.button==2&&G(r,[_,m],!0)},!1),i.domElement.addEventListener("mousemove",r=>{qe(G(r,[_,m],!1))},!1)}const O=new Se;let M=z({x:y[0].toFixed(4),y:y[1].toFixed(4),z:y[2].toFixed(4)});function G(e,s,n){const{left:r,top:C,width:P,height:g}=i.domElement.getBoundingClientRect(),L=new q((e.clientX-r)/P*2-1,-((e.clientY-C)/g)*2+1);O.setFromCamera(L,c);const R=O.intersectObjects(s);if(!(R.length<=0)){const{x:oe,y:ie,z:le}=R[0].point;M.value={x:oe.toFixed(4),y:ie.toFixed(4),z:le.toFixed(4)},n&&console.log(R[0].point)}}let S;function se(){const e=[[127.0336710235448,.011545204082892724,28.64362043559847],[127.03202433857018,.010294804244423972,3.596998487214975],[129.9670179100654,.011629521516418606,3.596576963129216],[129.93249707398147,0,28.62744385704633],[127.0336710235448,.011545204082892724,28.64362043559847]];S=Ce({material:Pe({height:3}),path:e,height:3}),a.add(S)}function ne(){a.add(new ke("#ffffff",.8))}let T,E=.02;function U(){B&&(B.material.uniforms.time.value+=E),D&&(D.material.uniforms.time.value+=E),S&&(S.material.uniforms.time.value+=.005),F&&(F.material.map.offset.x-=E),f==null||f.render(a,c),u.update(),$.forEach(e=>e.update(Be.getDelta())),i==null||i.render(a,c),T=requestAnimationFrame(U)}return(e,s)=>{const n=ze;return H(),X("div",{ref_key:"container",ref:o},[Ne(t("div",gt,[Y(n,{scale:2},{default:Xe(()=>[t("span",wt,d(l(A))+"% ",1)]),_:1})],512),[[He,l(k)]]),t("div",bt,[t("span",null,"经度："+d(l(M).x),1),t("span",null,"纬度："+d(l(M).z),1),t("span",null,"海拔："+d(l(M).y),1)])],512)}}}),Ct=N(xt,[["__scopeId","data-v-7291aa72"]]);export{Ct as t};
